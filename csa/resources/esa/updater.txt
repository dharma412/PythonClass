# $Id: $
# $DateTime: $
# $Author: $

*** Settings ***
Resource   esa/updater.txt

*** Keywords ***
Verify Engine Is Updated
    [Arguments]  ${engine}  ${wait_time}=15 minutes
    ${update_server}   Get Update Server
    Update Config Dynamichost  dynamic_host=${update_server}
    Update Config Validate Certificates  validate_certificates=No
    Commit

    Roll Over Now  logname=updater
    Sleep  3s  msg=Wait for logs rollover
    Update Now  force=${True}
    ${result}  ${msg}=  Run Keyword And Ignore Error
    ...  verify And Wait For Log Records
    ...  search_path=updater
    ...  wait_time=${wait_time}
    ...  retry_time=15 seconds
    ...  ${engine} update completed >= 1
    Run Keyword If  "${result}"=="FAIL"
    ...  Log  Test(s) might FAIL as ${engine} was not updated within ${wait_time} timeout.
    ...  level=WARN

